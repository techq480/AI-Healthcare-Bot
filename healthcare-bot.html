<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Healthcare Bot</title>
    <style>
        /* Previous styles remain the same */
        
        /* New styles for sender indicators */
        .message-header {
            font-size: 12px;
            font-weight: bold;
        }
        
        body {
            background-color: #f7f7f7;
            height: 100vh;
            display: flex;
        }
        
        /* Sidebar styles */
        .sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #e5e5e5;
            display: flex;
            flex-direction: column;
        }
        
        .new-chat-btn {
            margin: 16px;
            padding: 8px 16px;
            background-color: #000;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }
        
        .new-chat-btn span {
            margin-right: 8px;
        }
        
        .chat-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .chat-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .chat-item:hover {
            background-color: #f5f5f5;
        }
        
        .chat-item svg {
            margin-right: 12px;
            width: 20px;
            height: 20px;
        }
        
        .sidebar-actions {
            border-top: 1px solid #e5e5e5;
        }
        
        .sidebar-action {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            width: 100%;
            text-align: left;
            background: none;
            border: none;
        }
        
        .sidebar-action:hover {
            background-color: #f5f5f5;
        }
        
        .sidebar-action svg {
            margin-right: 12px;
            width: 20px;
            height: 20px;
        }
        
        /* Main content styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 24px;
            overflow-y: auto;
        }
        
        .bot-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 32px;
            text-align: center;
        }

        /* Message styles */
        .message {
            max-width: 70%;
            padding: 12px 16px;
            margin: 8px;
            border-radius: 12px;
            position: relative;
        }

        .user-message {
            background-color: #007bff;
            color: white;
            align-self: flex-end;
        }

        .bot-message {
            background-color: #f0f0f0;
            color: #333;
            align-self: flex-start;
        }

        .message-timestamp {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .loading {
            display: flex;
            justify-content: center;
            padding: 16px;
        }

        .error-message {
            color: #dc3545;
            padding: 16px;
            text-align: center;
        }
        
        .input-container {
            padding: 16px;
            border-top: 1px solid #e5e5e5;
        }
        
        .message-input {
            display: flex;
            align-items: center;
            background-color: #f0f0f0;
            border-radius: 9999px;
            padding: 8px 16px;
        }
        
        .message-input input {
            flex: 1;
            border: none;
            background: transparent;
            outline: none;
            padding: 8px;
            font-size: 14px;
        }
        
        .input-button {
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <button class="new-chat-btn">
            <span>+</span>
            New chat
        </button>
        
        <div class="chat-list" id="chatList">
            <!-- Chat items will be dynamically added here -->
        </div>
        
        <div class="sidebar-actions">
            <button class="sidebar-action">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 7L5 7M19 17L5 17M5 12L19 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Clear conversations
            </button>
            
            <button class="sidebar-action">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 12L12 8M12 12L16 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Light mode
            </button>
            
            <button class="sidebar-action">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
                    <path d="M5 20C5 16.6863 8.13401 14 12 14C15.866 14 19 16.6863 19 20" stroke="currentColor" stroke-width="2"/>
                </svg>
                My account
            </button>
            
            <button class="sidebar-action">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 7V16M9 10L12 7L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <rect x="4" y="17" width="16" height="2" rx="1" stroke="currentColor" stroke-width="2"/>
                </svg>
                Updates & FAQ
            </button>
            
            <button class="sidebar-action">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 16V8M19 13L16 16L13 13M9 8L9 16M6 11L9 8L12 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Log out
            </button>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="chat-container">
            <h1 class="bot-title">AI Healthcare Bot</h1>
            <!-- Chat messages would appear here -->
        </div>
        
        <div class="input-container">
            <div class="message-input">
                <button class="input-button">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 8V16M8 12H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <input type="text" placeholder="Type message..." id="messageInput">
                <button class="input-button" id="sendButton">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.5607 11.4393L4.56066 3.43934C3.99771 3.15804 3.32796 3.36459 3.04666 3.92754C2.89249 4.23892 2.89722 4.60841 3.05801 4.91474L7.2929 12L3.05801 19.0853C2.76745 19.6412 2.96251 20.3145 3.51836 20.6051C3.83283 20.7702 4.21133 20.7737 4.52963 20.614L20.5296 12.614C21.0829 12.3384 21.3089 11.6743 21.0334 11.121C20.9293 10.9082 20.7736 10.7297 20.5746 10.5974L20.5607 11.4393ZM20.5607 11.4393L4.56066 19.4393" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = 'http://localhost:5000/api';
        let currentChatId = null;

        // DOM elements
        const chatListElement = document.getElementById('chatList');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatContainer = document.querySelector('.chat-container');

        // Initialize chat list from API
        async function initChatList() {
            try {
                const response = await fetch(`${API_BASE}/chats`);
                const chats = await response.json();
                
                chatListElement.innerHTML = '';
                chats.forEach(chat => {
                    const chatItem = document.createElement('div');
                    chatItem.className = 'chat-item';
                    chatItem.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M8 12H16M8 8H16M8 16H16" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        ${chat.title}
                    `;
                    chatListElement.appendChild(chatItem);
                    
                    // Add click event
                    chatItem.addEventListener('click', () => {
                        loadChat(chat.id);
                    });
                });
                
                // Load first chat by default
                if (chats.length > 0) {
                    loadChat(chats[0].id);
                }
            } catch (error) {
                console.error('Failed to load chats:', error);
            }
        }

        // Load chat messages
        async function loadChat(chatId) {
            currentChatId = chatId;
            try {
                const response = await fetch(`${API_BASE}/chats/${chatId}/messages`);
                const messages = await response.json();
                displayMessages(messages);
            } catch (error) {
                console.error('Failed to load messages:', error);
            }
        }

        // Display messages in chat container
        function displayMessages(messages) {
            chatContainer.innerHTML = '';
            messages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${msg.is_bot ? 'bot-message' : 'user-message'}`;
                messageElement.textContent = msg.content;
                chatContainer.appendChild(messageElement);
            });
        }

        // Handle message sending
        async function handleSendMessage() {
            const message = messageInput.value.trim();
            if (message && currentChatId) {
                try {
                    const response = await fetch(`${API_BASE}/chats/${currentChatId}/messages`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            content: message,
                            is_bot: false
                        })
                    });
                    
                    if (response.ok) {
                        messageInput.value = '';
                        loadChat(currentChatId); // Refresh messages
                    }
                } catch (error) {
                    console.error('Failed to send message:', error);
                }
            }
        }

        // Event listeners
        sendButton.addEventListener('click', handleSendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSendMessage();
            }
        });

        // Handle new chat creation
        async function handleNewChat() {
            try {
                const response = await fetch(`${API_BASE}/chats`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: 'New Chat'
                    })
                });
                
                if (response.ok) {
                    initChatList(); // Refresh chat list
                }
            } catch (error) {
                console.error('Failed to create new chat:', error);
            }
        }

        // Add event listener to new chat button
        document.querySelector('.new-chat-btn').addEventListener('click', handleNewChat);

        // Handle clear conversations
        async function handleClearConversations() {
            try {
                const response = await fetch(`${API_BASE}/chats`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    // Clear UI
                    chatListElement.innerHTML = '';
                    chatContainer.innerHTML = '';
                    
                    // Create new default chat
                    await handleNewChat();
                }
            } catch (error) {
                console.error('Failed to clear conversations:', error);
            }
        }

        // Add event listener to clear conversations button
        document.querySelector('.sidebar-action').addEventListener('click', handleClearConversations);

        // Initialize the app
        initChatList();
    </script>
</body>
</html>
